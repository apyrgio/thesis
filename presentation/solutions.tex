\section{Caching}

\begin{frame}{Intro}

	Solution: Caching\\
	\spc
	Caching is:
	\begin{itemize}
		\item We have a slow medium
		\item Add a fast medium in a data path
		\item Transparently store the data that are intended for the 
			slower medium.
		\item Profit: later accesses to the same data are faster
	\end{itemize}
	\dspc
	Sounds familiar?

	\note[item]{Η κλασσική λύση σε τέτοια προβλήματα είναι η χρήση ενός 
		γρηγορότερου αποθηκευτικού μέσου για caching.}
	\note[item]{Για όσους δεν ξέρουν τι σημαίνει caching, θα το εξηγήσουμε 
		συνοπτικά: έχεις ροή, αργό μέσο, βάζεις ένα γρήγορο, speedup}
	\note[item]{Προφανώς αυτό το concept είναι γνωστό. Από που;}
\end{frame}

\begin{frame}
	\makebox[\textwidth]{\includegraphics[width=0.8\textwidth]{images/mem-hier.pdf}}
	
	That's because every PC is built that way.

	\note[item]{Από το ιεραρχικό μοντέλο του υπολογιστή: cpu cache vs ram, ram 
		vs disk}
\end{frame}

\begin{frame}
	Is there anything to help us?
	\dspc
	FACT: We are not the first to have speed issues\\
	Facebook, Twitter, Dropbox, every one has hit and surpassed their limits.
	\dspc
	There are solutions separated in two categories:
	\begin{itemize}
		\item Block-based caching
		\item Object-based caching
	\end{itemize}
	\note[item]{Τώρα που ξέρουμε τη λύση, υπάρχει κάτι που μπορούμε να 
		κάνουμε;}
	\note[item]{Υπάρχει κάτι έτοιμο; ΝΑΙ}
	\note[item]{Δυο κατηγορίες:
		\begin{itemize}
			\item βλέπουν τα δεδομένα σαν blocks ενός δίσκου
			\item βλέπουν τα δεδομένα σαν κομμάτια αντικειμένων
		\end{itemize}
		Διαφορά: \todo
	}
\end{frame}

\begin{frame}{Block-based caching solutions}

	Most notable examples:
	\begin{itemize}
		\item Bcache
		\item Flashcache
		\item EnhanceIO
	\end{itemize}
	\dspc
	Typically scale-up solutions.
	\dspc
	Pros: Simple, scale-up\\
	Cons: Unaware of CoW, kernel solutions

	\note[item]{Δε θα επεκταθούμε γιατί έχουν κάποια βασικά κοινά:
		\begin{itemize}
			\item Kernel modules
			\item expose εικονικά block devices που δείχνουν σε 
				γρήγορα μέσα
			\item Καθαρά caching μηχανισμοί με policies
		\end{itemize}
	}
	\note[item]{Εξήγησε που μπαίνουν (xsegbd). ΠΗΓΑΙΝΕ στο archipelago}
	\note[item]{Παρότι είναι αρκετά απλοί, δε γνωρίζουν την CoW πολιτική 
		άρα χάνουν χώρο και είναι στον kernel (που δε θέλουμε)
	}
\end{frame}

\begin{frame}{Object-based caching solutions}
	Most notable examples:
	\begin{itemize}
		\item Memcached
		\item Couchbase
	\end{itemize}
	\dspc
	Typically scale-out solutions
	\dspc
	Pros: Distributed with no SPOF, can utilize unneeded RAM\\
	Cons: Memcached has no persistence, Couchbase cannot use RADOS as its 
	backend, more suitable for databases
	\note{Τα πράγματα γίνονται πιο ενδιαφέροντα εδώ:
		\begin{itemize}
			\item Κατανεμημένα συστήμα χωρίς ενιαίο σημείο 
				αποτυχίας (SPOF), μπορούν να τρέχουν εκτός host 
				οπότε δεν το επιβαρύνουν
			\item Memcached δε διατηρεί τα δεδομένα, couchbase δεν 
				μπορεί να μιλήσει με rados
		\end{itemize}
	}
\end{frame}

\begin{frame}{Page-cache?}

	What if we used the page-cache?
	\note{Αν χρησιμοποιούσαμε την page-cache}
	\dspc
	\dspc
	\dspc
	Pros: Easy to activate, tested, very fast\\
	Cons: Unaware of CoW, no control over it, practically kernel solution\\
	\note{Εύκολη λύση, σταθερή και γρήγορη. Όμως, δεν καταλαβαίνει από COW, 
		είναι προσκολλημένη σε ένα block device}

\end{frame}

\begin{frame}{Conclusions}

	\begin{itemize}
		\item Most solutions far from Archipelago's logic
		\item Others not suited for storage and more suited for 
			databases
		\item Block-based caching might be good for the storage backend
		\item Must implement our own solution
	\end{itemize}

	\note{\todo}
\end{frame}
	
